{% extends "base.html" %}
{% block title %}Param√®tres WiFi{% endblock %}
{% block content %}
    <h2><i class="fas fa-wifi"></i> Param√®tres WiFi</h2>
    
    {% if current_wifi %}
    <div style="background: #06d6a0; color: white; padding: 1em; margin: 1em auto; width: 300px; border-radius: 1em; text-align: center;">
        <strong>Connect√© √†: {{ current_wifi }}</strong>
    </div>
    {% endif %}
    
    {% if error %}connections.connections.
    <div style="background: #f582ae; color: white; padding: 1em; margin: 1em auto; width: 300px; border-radius: 1em; text-align: center;">
        <strong>{{ error }}</strong>
    </div>
    {% endif %}
    
    <div class="wifi-networks">
        <h3>R√©seaux disponibles</h3>
        
        {% if networks %}
            {% for network in networks %}
            <div class="wifi-network" onclick="connectToWifi('{{ network.ssid }}', {{ network.secured|tojson }})">
                <div class="network-info">
                    <div class="network-name">
                        {% if network.secured %}üîí{% else %}üì∂{% endif %} 
                        {{ network.ssid }}
                    </div>
                    <div class="network-details">
                        Signal: {{ network.signal }}% | {{ network.security }}
                    </div>
                </div>
                <div class="signal-bars">
                    {% set signal_level = (network.signal|int / 25)|round %}
                    {% for i in range(4) %}
                        <div class="bar {% if i < signal_level %}active{% endif %}"></div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p>Aucun r√©seau WiFi trouv√©. <a href="{{ url_for('connections.wifi_settings') }}">Rafra√Æchir</a></p>
        {% endif %}
    </div>

<!-- Modal pour saisir le mot de passe -->
<div id="passwordModal" class="photo-modal" style="display: none;">
    <div style="background: white; color: #001858; padding: 2em; border-radius: 1em; margin: 20vh auto; width: 300px; position: relative;">
        <h3 style="margin-top: 0;">Se connecter √† <span id="networkName"></span></h3>
        <form method="POST" action="{{ url_for('wifi.wifi_connect') }}">
            <input type="hidden" id="ssidInput" name="ssid" value="">
            <label for="password">Mot de passe :</label><br>
            <input type="password" id="passwordInput" name="password" style="width: 100%; padding: 0.5em; margin: 0.5em 0; box-sizing: border-box;">
            <br>
            <button type="submit" style="background: #06d6a0; color: white; border: none; padding: 0.5em 1em; border-radius: 0.5em; cursor: pointer; margin-right: 0.5em;">Se connecter</button>
            <button type="button" onclick="closePasswordModal()" style="background: #f582ae; color: white; border: none; padding: 0.5em 1em; border-radius: 0.5em; cursor: pointer;">Annuler</button>
        </form>
    </div>
</div>

<script>
function connectToWifi(ssid, secured) {
    if (secured) {
        document.getElementById('networkName').textContent = ssid;
        document.getElementById('ssidInput').value = ssid;
        document.getElementById('passwordInput').value = '';
        document.getElementById('passwordModal').style.display = 'block';
        document.getElementById('passwordInput').focus();
    } else {
        // R√©seau ouvert, connexion directe
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{{ url_for("wifi.wifi_connect") }}';
        
        const ssidInput = document.createElement('input');
        ssidInput.type = 'hidden';
        ssidInput.name = 'ssid';
        ssidInput.value = ssid;
        form.appendChild(ssidInput);
        
        document.body.appendChild(form);
        form.submit();
    }
}

function closePasswordModal() {
    document.getElementById('passwordModal').style.display = 'none';
}

// Fermer le modal en cliquant √† c√¥t√©
document.getElementById('passwordModal').addEventListener('click', function(e) {
    if (e.target === this) closePasswordModal();
});
</script>

<style>
.wifi-networks {
    max-width: 600px;
    margin: 2em auto;
}

.wifi-network {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: white;
    margin: 0.5em 0;
    padding: 1em;
    border-radius: 1em;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
}

.wifi-network:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.network-info {
    flex: 1;
}

.network-name {
    font-weight: bold;
    font-size: 1.1em;
    color: #001858;
}

.network-details {
    font-size: 0.9em;
    color: #666;
    margin-top: 0.2em;
}

.signal-bars {
    display: flex;
    gap: 2px;
    align-items: flex-end;
}

.bar {
    width: 6px;
    background: #ddd;
    border-radius: 1px;
}

.bar:nth-child(1) { height: 8px; }
.bar:nth-child(2) { height: 12px; }
.bar:nth-child(3) { height: 16px; }
.bar:nth-child(4) { height: 20px; }

.bar.active {
    background: #06d6a0;
}

/* Media queries pour √©cran 320x480px */
@media screen and (max-width: 320px) {
    .wifi-networks {
        max-width: 100%;
        margin: 1em 0.5em;
    }

    .wifi-networks h3 {
        font-size: 1.1em;
    }

    .wifi-network {
        margin: 0.4em 0;
        padding: 0.7em;
        font-size: 0.9em;
    }

    .network-name {
        font-size: 1em;
    }

    .network-details {
        font-size: 0.75em;
    }

    .signal-bars {
        gap: 1px;
    }

    .bar {
        width: 5px;
    }

    .bar:nth-child(1) { height: 6px; }
    .bar:nth-child(2) { height: 10px; }
    .bar:nth-child(3) { height: 14px; }
    .bar:nth-child(4) { height: 18px; }

    /* Adapter les divs de statut */
    div[style*="width: 300px"] {
        width: 280px !important;
        padding: 0.7em !important;
        font-size: 0.9em !important;
    }

    /* Modal de mot de passe */
    #passwordModal > div {
        width: 280px !important;
        padding: 1.5em !important;
        margin: 15vh auto !important;
    }

    #passwordModal h3 {
        font-size: 1.1em;
    }

    #passwordModal input[type="password"] {
        font-size: 0.9em;
    }

    #passwordModal button {
        font-size: 0.85em;
        padding: 0.4em 0.8em !important;
    }
}
</style>
{% endblock %}